

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/jg-square.png">
  <link rel="icon" href="/img/jg.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="jin">
  <meta name="keywords" content="">
  
    <meta name="description" content="参数化的几种方法, 参数化的应用 (纹理映射, 几何图像), 表示纹理的其他方法 (八叉树, mesh colors).">
<meta property="og:type" content="article">
<meta property="og:title" content="参数化与纹理">
<meta property="og:url" content="https://disembo.github.io/Note/CG/proc-4-parameterization/index.html">
<meta property="og:site_name" content="Jin&#39;s Blog">
<meta property="og:description" content="参数化的几种方法, 参数化的应用 (纹理映射, 几何图像), 表示纹理的其他方法 (八叉树, mesh colors).">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-parameterization.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-parameterization-pieces.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-tutte.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-tutte-distortion.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-orbifold-tutte.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-orbifold-tutte-orbifold.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-lscm-vs-arap.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-arap.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-textures.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-textures-normal.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-geometry-images.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-geometry-images-normal.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-geometry-images-mipmap.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-mesh-colors.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-mesh-colors-editing.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-mesh-colors-non-uniform.png">
<meta property="article:published_time" content="2025-03-21T14:00:00.000Z">
<meta property="article:modified_time" content="2025-04-06T14:13:28.818Z">
<meta property="article:author" content="jin">
<meta property="article:tag" content="计算机图形学">
<meta property="article:tag" content="计算几何">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-parameterization.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>参数化与纹理 | Jin&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/additional.css">
<link rel="stylesheet" href="/css/html-hint.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"disembo.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"#"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":3},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<!-- hexo injector head_end start --><script src="/js/mathjax-cfg.js"></script><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Jin&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="参数化与纹理"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-03-21 22:00" pubdate>
          2025年3月21日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">参数化与纹理</h1>
            
            
              <div class="markdown-body">
                
                <html><head></head><body>
<p>纹理映射 (texture map)
可以为三角形网格上的每个点添加颜色和法向量等信息,
进而实现更细致、真实的渲染. 纹理映射最经典也最常用的方法是参数化,
即建立起曲面与平面区域的一一对应.</p>
<h2 id="参数化">9  参数化</h2>
<p>设三角形网格 <span class="math inline">\({\cal K}\)</span>, 欧氏平面
<span class="math inline">\(\R^2\)</span> 称为 uv-平面.
参数化指的是分片线性映射 <span class="math inline">\(\varphi:|{\cal
K}|\to\R^2\)</span><span class="hint--html hint--top hint--hoverable hint--rounded hint--autosize"><hcontent class="hint__content"><span class="math inline">\(|{\cal K}|\)</span> 是 <span class="math inline">\({\cal K}\)</span> 的承载空间 (underlying space).</hcontent><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref" style="text-decoration: none;"><sup>[1]</sup></a></span>, 它将每个三角形 <span class="math inline">\(T\subset{\cal K}\)</span> 映到 <span class="math inline">\(\R^2\)</span> 上的非退化三角形 <span class="math inline">\(\varphi(T)\)</span>. 参数化 <span class="math inline">\(\varphi\)</span> 的效果是将曲面 <span class="math inline">\({\cal K}\)</span> "展平", 如下图 (图自课程
PPT).</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-parameterization.png" cloud-img="" style="zoom:40%;" lazyload="true"></p>
<ul>
<li><span class="math inline">\(\varphi\)</span> 也叫 uv-map.</li>
<li><span class="math inline">\(\varphi\)</span>
在每个三角形上都是非退化线性映射.</li>
<li>作为单纯复形间的映射, <span class="math inline">\(\varphi\)</span>
完全由所有顶点的像确定.</li>
</ul>
<p>一般而言, <span class="math inline">\(|{\cal K}|\)</span>
的拓扑是非平凡的, 它不同胚于某个平面区域 <span class="math inline">\(U\subset\R^2\)</span>. 这时我们就不能强求 <span class="math inline">\(\varphi\)</span> 是连续的,
即认为它在某些三角形的边界上非连续. 换言之, 我们将 <span class="math inline">\(|{\cal K}|\)</span> 沿着其中的某些边 "剪开",
令其作为 <span class="math inline">\({\cal K}\)</span> 的流形边界.
在某些情况下, 我们甚至需要把 <span class="math inline">\({\cal
K}\)</span> 完全剪断, 切成若干连通分量 (如下图, 图自论文<span class="hint--html hint--top hint--hoverable hint--rounded hint--autosize"><hcontent class="hint__content">Bruno Lévy et al, <em>Least Squares Conformal Maps for
Automatic Texture Atlas Generation</em> (TOG, 2002).</hcontent><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref" style="text-decoration: none;"><sup>[2]</sup></a></span>).</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-parameterization-pieces.png" cloud-img="" style="zoom:40%;" lazyload="true"></p>
<p>我们的目标就是找到一个尽量好的参数化, 它满足:</p>
<ul>
<li>减小边界 <span class="math inline">\(\partial|{\cal K}|\)</span>
的长度和个数, 减少 <span class="math inline">\(|{\cal K}|\)</span>
连通分量的个数 (减少碎片).</li>
<li>不重叠 (即 <span class="math inline">\(\varphi\)</span> 单).</li>
<li>三角形不翻转 (即 <span class="math inline">\(\varphi\)</span>
保持定向. 在这里我们认为 <span class="math inline">\({\cal K}\)</span>
可定向).</li>
<li>变形小 (low distortion), 可以保持面积、角度甚至度量.
<ul>
<li>这是很强的条件.</li>
</ul></li>
</ul>
<p>下面介绍的几种优化办法都是定义一个形变能量 <span class="math inline">\(E(\varphi)\)</span> (形变越大, 能量越大),
然后通过优化能量的办法来优化 <span class="math inline">\(\varphi\)</span>.</p>
<h3 id="tutte-嵌入">9.1  Tutte 嵌入</h3>
<p>Tutte 映射首先把 <span class="math inline">\(|{\cal K}|\)</span>
沿着一条线段剪开, 于是 <span class="math inline">\(\partial|{\cal
K}|\)</span> 的边界同胚于 <span class="math inline">\(\mathbb{S}^1\)</span>, 然后把 <span class="math inline">\(\partial|{\cal K}|\)</span> 均匀的放到凸域 <span class="math inline">\(A\)</span> 的边界上 (比如圆或者正方形), 而 <span class="math inline">\(|{\cal K}|\)</span> 的内部一一映射到凸域的内部,
如下图所示 (将牛沿着肚子切开, 然后展平到单位圆上. 图自课程 PPT).</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-tutte.png" cloud-img="" style="zoom:40%;" lazyload="true"></p>
<p>内部顶点 <span class="math inline">\(v\)</span> 的像 <span class="math inline">\(u=\varphi(v)\)</span> 如何求解? 我们把 <span class="math inline">\(\varphi({\cal K})\)</span> 想像成一个弹簧系统,
每条边 <span class="math inline">\((u_i,u_j)\)</span> 都是一根弹簧,
劲度系数为 <span class="math inline">\(D_{ij}\)</span>.
我们把弹簧系统的稳态作为 <span class="math inline">\(u\)</span> 的位置.
该系统的能量为 <span class="math display">\[
E = \frac12 \sum_{i=1}^n\sum_{j\in{\cal N}(i)} \frac12
D_{ij}\|u_i-u_j\|^2.
\]</span> 该能量函数是凸函数, 考虑求导. 为了简便, 记 <span class="math inline">\(\lambda_{ij}=D_{ij}/\sum_k D_{ik}\)</span>, 则
<span class="math display">\[
\Align{
0 = \pdv{E}{u_i} &amp;= \sum_{j\in{\cal N}(i)} D_{ij} (u_i-u_j) \\
\iff u_i &amp;= \sum_{j\in{\cal N}(i)} \lambda_{ij} u_j.
}
\]</span> 为了方便, 不妨设前 <span class="math inline">\(m\)</span>
个点为内部点 (未知量), 后面的点为边界点 (已知量). 将已知与未知分离, 得到
<span class="math display">\[
u_i - \sum_{\substack{j\in{\cal N}(i)\\j\leq m}} \lambda_{ij}u_j
= \sum_{\substack{j\in{\cal N}(i)\\j&gt;m}} \lambda_{ij}u_j.
\]</span> 也就是求解下面的线性系统 (带边界条件的 Laplace 方程): <span class="math display">\[
LX = B,
\]</span> 其中:</p>
<ul>
<li><span class="math inline">\(X=\pmqty{u_1&amp;\cdots&amp;u_m}\T\)</span>,</li>
<li><span class="math inline">\(B_i=\sum_{j\in{\cal
N}(i),j&gt;m}\lambda_{ij}u_j\T\)</span>,</li>
<li>稀疏的 <span class="math inline">\(m\times m\)</span> 对称矩阵 <span class="math inline">\(L_{ij}=\Cases{1,&amp;i=j,\\-\lambda_{ij},&amp;j\in{\cal
N}(i),\\0,&amp;\textsf{otherwise}.}\)</span>
<ul>
<li>若取 uniform <span class="math inline">\(D_{ij}=1\)</span>, <span class="math inline">\(L\)</span> 就是图的 Laplace 矩阵.
此时的优化只考虑网格的拓扑连接, 不考虑几何.</li>
<li>若取 cotangent <span class="math inline">\(D_{ij}=\frac12(\cot\alpha_{ij}+\cot\beta_{ij})\)</span>,
<span class="math inline">\(L\)</span> 就是三角形网格的离散
Laplace-Beltrami 算子.</li>
</ul></li>
</ul>
<p>上面的方程 <span class="math inline">\(LX=B\)</span> 的解使得 uv
坐标的 Laplace-Beltrami 为零, 即 <span class="math inline">\(\varphi\)</span> 为调和映射. 这类似于网格去噪的
Laplace 平滑, 即给定初始温度 (边界点的 uv 坐标) 之后让温度梯度 <span class="math inline">\(\int_{|{\cal K}|}\|\nabla u\|^2\dd{V}\)</span> (即
Dirichlet 能量) 尽可能小.</p>
<p>Tutte 映射可以保证 uv-map 没有翻转 (直观来看,
翻转的三角形必然导致弹簧能量增大). 但是它的优化结果通常有很大的变形
(如下图, 图自课程 PPT), 适合作为后续进一步优化的初始状态.</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-tutte-distortion.png" cloud-img="" style="zoom:45%;" lazyload="true"></p>
<h3 id="orbifold-tutte-嵌入">9.2  Orbifold Tutte 嵌入</h3>
<div class="note note-secondary">
<p>原论文: Noam Aigerman, Yaron Lipman <em>Orbifold Tutte
Embeddings</em> (SIGGRAPH Asia 2015).</p>
</div>
<p>Tutte 嵌入变形比较大的一个原因是它对边界 <span class="math inline">\(\varphi(\partial|{\cal K}|)\)</span>
做了过强的约束, 把它固定在了给定 <span class="math inline">\(\partial{A}\)</span> 上. Orbifold-Tutte
映射放松这个条件, 它只要求边界上的四个点 <span class="math inline">\(v_i\)</span> 固定在单位正方形的四个顶点处,
如下图的四个彩色点 (图自原论文).</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-orbifold-tutte.png" cloud-img="" style="zoom:40%;" lazyload="true"></p>
<p>除此之外, 它还要求 uv-平面内的四条折边两两旋转认同, 如上图,
两条红色的边通过旋转 <span class="math inline">\(\pi/2\)</span>
可以重合; 两条蓝色的边也是. 如此一来, 其实我们只需选择 <span class="math inline">\({\cal K}\)</span> 上的 <span class="math inline">\(3\)</span> 个顶点 (如左侧的模型上的三个点),
然后用两条路径连接它们, 将网格沿着路径切开即可.</p>
<ul>
<li>接下来的步骤就和 Tutte 一样了, 求解线性系统得到调和映射 <span class="math inline">\(\varphi\)</span>.</li>
<li>可以证明, 路径的选择不影响 <span class="math inline">\(\varphi\)</span> (在旋转对称性意义下).
算法的结果只取决于 <span class="math inline">\(3\)</span>
个顶点的选择.</li>
</ul>
<p>Orbitfold Tutte 的好处是它一方面有更高的灵活度, 可以尽量减少扭曲;
另一方面, 旋转认同的条件保证了 <span class="math inline">\(\varphi(|{\cal K}|)\)</span> 可以在 uv-平面上密铺
(如下图, 图自原论文).</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-orbifold-tutte-orbifold.png" cloud-img="" style="zoom:40%;" lazyload="true"></p>
<p>原论文基于轨形 (orbifold) 的概念, 还探讨了其他的切割与密铺方式,
这里不细展开. 感兴趣的可以阅读原论文.</p>
<h3 id="参数化的微分">9.3  参数化的微分</h3>
<p>让我们从一种更几何的角度考察映射 <span class="math inline">\(\varphi:|{\cal K}|\to\R^2\)</span>. 设三角形 <span class="math inline">\(T\subset|{\cal K}|\)</span>
上有局部正交归一坐标系, 在此之下三个顶点的坐标为 <span class="math inline">\((x_i,y_i)\)</span>. 在每个 <span class="math inline">\(T\)</span> 上, <span class="math inline">\(\varphi\)</span> 都是线性映射, 它将 <span class="math inline">\((x_i,y_i)\)</span> 映到平面上不共线的三个点 <span class="math inline">\((u_i,v_i)\)</span>.该线性映射的矩阵表示为 <span class="math display">\[
\pmqty{u_i\\v_i} =
\underbrace{
\pmqty{\displaystyle\pdv{u}{x} &amp; \displaystyle\pdv{u}{y} \\
       \displaystyle\pdv{v}{x} &amp; \displaystyle\pdv{v}{y}}
}_{J}
\pmqty{x_i\\y_i},
\]</span> (<span class="math inline">\(i=1,2,3\)</span>) 其中 <span class="math inline">\(J\)</span> 是 <span class="math inline">\(\varphi\)</span> 的 Jacobi 矩阵 (由于 <span class="math inline">\(\varphi\)</span> 分片线性, <span class="math inline">\(J\)</span> 在 <span class="math inline">\(|{\cal
K}|\)</span> 上分片常值). 对 <span class="math inline">\(J\)</span>
进行奇异值分解: <span class="math display">\[
J = U \pmqty{\sigma_1\\&amp;\sigma_2} V\T,
\]</span> 其中 <span class="math inline">\(U,V\)</span> 是 <span class="math inline">\(2\)</span> 阶正交阵, 奇异值 <span class="math inline">\(\sigma_1&gt;\sigma_2&gt;0\)</span>. 奇异值决定了
<span class="math inline">\(\varphi\)</span> 的几何性质:</p>
<ul>
<li><span class="math inline">\(\varphi\)</span> 保持面积当且仅当 <span class="math inline">\(\sigma_1\sigma_2=1\)</span>.</li>
<li><span class="math inline">\(\varphi\)</span> 保持角度当且仅当 <span class="math inline">\(\sigma_1=\sigma_2\)</span>, 此时 <span class="math inline">\(J\)</span> 称为相似变换, <span class="math inline">\(\varphi\)</span> 是一个共形映射 (conformal
map).</li>
<li><span class="math inline">\(\varphi\)</span> 保持度量当且仅当 <span class="math inline">\(\sigma_1=\sigma_2=1\)</span>, 此时 <span class="math inline">\(J\)</span> 为正交阵, <span class="math inline">\(\varphi\)</span> 是一个等距同构 (isometry).</li>
</ul>
<p>下面介绍的两种方法分别将 <span class="math inline">\(\varphi\)</span>
优化为共形映射与等距同构.</p>
<h3 id="最小二乘共形映射">9.4  最小二乘共形映射</h3>
<div class="note note-secondary">
<p>原论文: Bruno Lévy et al, <em>Least Squares Conformal Maps for
Automatic Texture Atlas Generation</em> (TOG, 2002).</p>
</div>
<h4 id="共形能量">9.4.1  共形能量</h4>
<p>我们希望最终的 <span class="math inline">\(\varphi\)</span>
是共形映射. 此时 uv 坐标的等值线互相正交; uv 平面上的三角形与 <span class="math inline">\({\cal K}\)</span> 上的三角形相差一个相似变换,
可以尽量保证图形的 "形状" 不变 (虽然面积可能发生较大的缩放).</p>
<p>我们将 uv-平面认同于复平面 <span class="math inline">\(\C\)</span>,
标准坐标为 <span class="math inline">\(u+\i v\)</span>; 同时将三角形
<span class="math inline">\(T\)</span> 的局部坐标也认同于 <span class="math inline">\(\C\)</span>, 标准坐标为 <span class="math inline">\(x+\i y\)</span>, 则 <span class="math inline">\(\varphi\)</span> 是复变函数. 此时共形条件等价于
Cauchy-Riemann 方程 <span class="math display">\[
\pdv{\varphi}{x} + \i\pdv{\varphi}{y} = 0.
\]</span> 由此定义共形能量 <span class="math display">\[
\Align{
E(\varphi)
:={}&amp; \int_{|{\cal K}|}
    \abs{\pdv{\varphi}{x} + \i\pdv{\varphi}{y}}^2 \dd{A} \\
={}&amp; \sum_{T} A_T \abs{\pdv{\varphi}{x} + \i\pdv{\varphi}{y}}^2,
}
\]</span> 其中<span class="math inline">\(A_T\)</span> 为三角形面积.</p>
<h4 id="lscm">9.4.2  LSCM</h4>
<p>在局部坐标下, <span class="math inline">\(\varphi\)</span> 的
Jacobian 为 <span class="math display">\[
\Align{
\pmqty{\displaystyle\pdv{u}{x} &amp; \displaystyle\pdv{u}{y} \\
       \displaystyle\pdv{v}{x} &amp; \displaystyle\pdv{v}{y}}
= \frac1{2A_T} \pmqty{u_1&amp;u_2&amp;u_3\\v_1&amp;v_2&amp;v_3} \pmqty{
    y_2-y_3 &amp; x_3-x_2 \\
    y_3-y_1 &amp; x_1-x_3 \\
    y_1-y_2 &amp; x_2-x_1 \\
},
}
\]</span> 引入记号 <span class="math display">\[
\Align{
\omega_1 &amp;:= (x_3-x_2) + \i(y_3-y_2), \\
\omega_2 &amp;:= (x_1-x_3) + \i(y_1-y_3), \\
\omega_3 &amp;:= (x_2-x_1) + \i(y_2-y_1), \\
}
\]</span> 以及 <span class="math inline">\(\zeta_i=u_i+\i v_i\)</span>,
则 C-R 方程的左边为 <span class="math display">\[
\pdv{\varphi}{x} + \i\pdv{\varphi}{y}
= \frac{\i}{2A_T}
    \pmqty{\omega_1&amp;\omega_2&amp;\omega_3}
    \pmqty{\zeta_1\\\zeta_2\\\zeta_3},
\]</span> 故能量函数为 <span class="math display">\[
E(\varphi) = \frac12\sum_T\abs{
    \pmqty{\omega_{j_1,T}&amp;\omega_{j_2,T}&amp;\omega_{j_3,T}}
    \pmqty{\zeta_{j_1}&amp;\zeta_{j_2}&amp;\zeta_{j_3}}\T
}^2.
\]</span> 其中 <span class="math inline">\((j_1,j_2,j_3)\)</span>
是三角形 <span class="math inline">\(T\)</span> 的三个顶点. 能量 <span class="math inline">\(E(\varphi)\)</span> 是关于未知量 <span class="math inline">\(Z=(\zeta_1,\dots,\zeta_n)\)</span> 的二次型.
它的一个极小值点是平凡解 <span class="math inline">\(0\)</span>.
为了防止它陷入平凡解, 我们需要事先给定一些点的 uv 坐标 (称为固定点).
论文使用最小二乘法求解该二次型的极小值点, 得到的 <span class="math inline">\(\varphi\)</span> 称为 LSCM (least squares
conformal map).</p>
<p>可以证明 (见原论文), 该最小二乘解具有如下性质:</p>
<ul>
<li>当固定点个数大于等于 <span class="math inline">\(2\)</span>
时有唯一解.</li>
<li>最小二乘解在 uv-平面的相似变换下不变.</li>
<li>最小二乘解与网格 <span class="math inline">\({\cal K}\)</span>
的分辨率无关.</li>
<li>若固定点都在 <span class="math inline">\(|{\cal K}|\)</span>
的边界上, 则参数化 <span class="math inline">\(\varphi\)</span> 保持定向
/ 三角形不翻转.</li>
</ul>
<h3 id="as-rigid-as-possible">9.5  As-rigid-as-possible</h3>
<div class="note note-secondary">
<p>原论文: Olga Sorkine, Marc Alexa, <em>As-rigid-as-possible surface
modeling</em>.</p>
</div>
<p>LSCM 可以尽量保证 uv 等值线正交, 但不能保证 uv 网格面积均匀 (下图左,
注意牛的头在 uv 平面被压缩得很小; 图自课程 PPT<span class="hint--html hint--top hint--hoverable hint--rounded hint--autosize"><hcontent class="hint__content">本文中所有牛的 uv map 效果图都是王老师自己实现的.</hcontent><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref" style="text-decoration: none;"><sup>[3]</sup></a></span>).
As-rigid-as-possible 求解出的等距同构可以保证 uv 网格具有尽量相同的尺寸
(下图右).</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-lscm-vs-arap.png" cloud-img="" style="zoom:35%;" lazyload="true"></p>
<p>等距同构的条件是 <span class="math inline">\(J\)</span> 的奇异值
<span class="math inline">\(\sigma_1=\sigma_2=1\)</span>, 即 <span class="math inline">\(J\)</span> 是正交阵. 该论文引入了辅助矩阵 <span class="math inline">\(L_T\)</span> (对每个三角形 <span class="math inline">\(T\)</span>), 并使用 local-global 交替优化
(类似之前在网格去噪提到的 <span class="math inline">\(L_0\)</span>-稀疏优化), 最终把 <span class="math inline">\(J\)</span> 和 <span class="math inline">\(L_T\)</span> 都优化为正交阵. 能量函数为 <span class="math display">\[
\Align{
E(\varphi)
&amp;= \sum_T A_T \|J_T-L_T\|_F^2 \\
&amp;= \sum_T \sum_{\textsf{边 }(x_i,x_j)}
    \cot(\theta_{ij})
    \Big\|(\varphi(x_i)-\varphi(x_j)) - L_T(x_i-x_j)\Big\|^2
}
\]</span> 其中 <span class="math inline">\(J_T\)</span> 是三角形 <span class="math inline">\(T\)</span> 处的 Jacobian, <span class="math inline">\(\theta_{ij}\)</span> 是边 <span class="math inline">\((x_i,x_j)\)</span> 在三角形 <span class="math inline">\(T\)</span> 中的对角, <span class="math inline">\(\|X\|_F:=\sqrt{\tr(X\T X)}\)</span> 为矩阵的
Frobenius 范数.</p>
<p>ARAP 可以使用 Tutte 映射或者 LSCM 作为初始化, 其迭代步骤如下:</p>
<ul>
<li><p>Local 步优化 <span class="math inline">\(L_T\)</span> 为正交阵.
注意每个三角形的 <span class="math inline">\(L_T\)</span> 互不相干,
因此对每个三角形优化出一个 <span class="math inline">\(L_T\)</span>
即可. 记矩阵 <span class="math display">\[
S_T := \sum_{\textsf{边 }(x_i,x_j)}
\cot(\theta_{ij}) (\varphi(x_i)-\varphi(x_j))(x_i-x_j)\T,
\]</span> 它的 SVD 分解为 <span class="math inline">\(S_T=U\Sigma
V\T\)</span>, 则 <span class="math inline">\(L_T\leftarrow
UV\T\)</span>. 可能要对 <span class="math inline">\(UV\T\)</span>
的某一列取负号, 保证 <span class="math inline">\(L_T\)</span>
的行列是为正, 保持定向.</p></li>
<li><p>Global 步优化顶点位置 <span class="math inline">\(\varphi(x_i)\)</span>. 即求解线性系统
(最小二乘法): <span class="math display">\[
\Align{
&amp;\sum_{j\in{\cal N}(i)}
(\cot\theta_{ij}+\cot\theta_{ji})
(\varphi(x_i)-\varphi(x_j)) \\
&amp;= \sum_{j\in{\cal N}(i)}
\bqty{\cot\theta_{ij}L_T + \cot\theta_{ji}L_{T'}} (x_i-x_j),
}
\]</span> 其中 <span class="math inline">\(T,T'\)</span> 是边 <span class="math inline">\((x_i,x_j)\)</span> 的两个相邻三角形.</p></li>
</ul>
<p>下图是 local-global 的可视化 (图自课程 PPT), local 步让
uv-平面内的三角形尽量和原三角形相同; global 步将
uv-平面中的三角形拼合起来.</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-arap.png" cloud-img="" style="zoom:40%;" lazyload="true"></p>
<h2 id="参数化的应用">10  参数化的应用</h2>
<h3 id="纹理映射">10.1  纹理映射</h3>
<p>参数化最大的应用就是纹理映射. 将三角形网格 <span class="math inline">\({\cal K}\)</span> 映到 uv-平面上的 <span class="math inline">\([0,1]\times[0,1]\)</span> 区域之后,
我们在该区域的每个点都存储几何体的颜色、法向量等信息, 就得到了纹理映射
(texture mapping).</p>
<p>本文开头的 bunny 图片就展示了一个纹理映射.
下面展示了在球面上映上不同纹理 (左<span class="hint--html hint--top hint--hoverable hint--rounded hint--autosize"><hcontent class="hint__content">© Joseph FS Leng, Art Station.</hcontent><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref" style="text-decoration: none;"><sup>[4]</sup></a></span>)、偏移量和法向量 (右<span class="hint--html hint--top hint--hoverable hint--rounded hint--autosize"><hcontent class="hint__content">From Fatahalian et.al, CS248.</hcontent><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref" style="text-decoration: none;"><sup>[5]</sup></a></span>) 的结果.
偏移量和法向量纹理可以让几何体在渲染时拥有更细致的表面.</p>
<table>

<thead>
<tr>
<th style="text-align: center;"><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-textures.png" cloud-img="" style="height:200px;" lazyload="true"></th>
<th style="text-align: center;"><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-textures-normal.png" cloud-img="" style="height:200px;" lazyload="true"></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>纹理 (texture) 一般用图片的形式存储 (法向量的三个分量可以分别作为 RGB
来存储). 三角形网格的 uv 坐标可以和顶点坐标一起存储在文件里 (例如
<code>.obj</code>):</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">(Vertex 1) x1 y1 z1 u1 v1<br>(Vertex 2) x2 y2 z2 u2 v2<br>...<br></code></pre></td></tr></tbody></table></figure>
<p>但是这样有一个小缺陷. 由于顶点在文件中并不是连续存储的
(即在文件中连续的顶点, 在空间中不一定连续), 这就导致文件中相邻顶点的 uv
坐标可能差距很大, 渲染器根据 uv 读取 texture 的时候空间局部性不是很好,
其性能还有提升空间.</p>
<h3 id="几何图像">10.2  几何图像</h3>
<div class="note note-secondary">
<p>原论文: Xianfeng Gu, Steven J. Gortler, Hugues Hoppe, <em>Geometry
Images</em> (SIGGRAPH 2002).</p>
<p>一作是 Yau 的学生顾险峰, 在图形学颇有造诣,
将微分几何的诸多理论应用到图形学中; 而 Hugues Hoppe 就是提出 Progressive
Mesh 的大佬.</p>
</div>
<h4 id="几何图像渲染法">10.2.1  几何图像渲染法</h4>
<p>参数化另一个很厉害的应用就是几何图像, 它在纹理映射上更进一步:
纹理映射既然可以存储几何体的表面材质, 那能不能直接存储几何体的顶点位置?
答案是肯定的.</p>
<p>将网格参数化之后, 我们在 uv-平面上的每个点用 RGB
的三个分量存储顶点位置, 即 <span class="math inline">\((R,G,B)=(x,y,z)\)</span> (位置归一化后),
这样就将一个 3D 几何体转化为了一个彩色图片. 并且, 这个过程是无损压缩
(一一对应), 可以从彩色图片还原出 3D 形体! (如下图, 图自论文的 PPT<span class="hint--html hint--top hint--hoverable hint--rounded hint--autosize"><hcontent class="hint__content">https://www.hhoppe.com/gim.ppt</hcontent><a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref" style="text-decoration: none;"><sup>[6]</sup></a></span>, 下同).</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-geometry-images.png" cloud-img="" style="zoom:40%;" lazyload="true"></p>
<p>在渲染时, 把图像上相邻的像素点连接成三角形网格, 再塞进渲染管线里.
另外还可以实现带属性的渲染,
比如用一张粗分辨率的几何图像表示粗糙的几何形体, 再用一张高分辨率的
normal map 表示法向量信息, 如下图.</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-geometry-images-normal.png" cloud-img="" style="zoom:40%;" lazyload="true"></p>
<p>几何图像还可以用于压缩和多分辨率表示 (LOD),
存储不同分辨率的几何图像来实现动态的分辨率和 level-of-details.</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-geometry-images-mipmap.png" cloud-img="" style="zoom:40%;" lazyload="true"></p>
<p>几何图像渲染法的好处多多, 论文 PPT 中总结如下:</p>
<ul>
<li>Simple rendering: compact, no indirection, raster-scan stream.
<ul>
<li>所有信息都存储在几张图片里面, 无需 <code>.obj</code> 文件和 uv 坐标.
渲染时逐行扫描图像, 局部性良好.</li>
</ul></li>
<li>Mipmapped geometry</li>
<li>Hierarchical culling</li>
<li>Compressible</li>
</ul>
<h4 id="与深度学习结合">10.2.2  与深度学习结合</h4>
<p>把几何体变成图像之后, 就可以使用图像处理技巧处理 3D 问题了,
比如用神经网络进行几何理解、几何生成.</p>
<h2 id="表示纹理的其他方法">11  表示纹理的其他方法</h2>
<p>参数化与纹理映射存在一些问题, 比如:</p>
<ul>
<li>怎样切缝?
<ul>
<li>良好的参数化依赖切缝 / 切点的选取.</li>
</ul></li>
<li>怎样将不同的片拼到一个正方形区域内?
<ul>
<li><span class="math inline">\(\varphi(|{\cal K}|)\)</span>
的几个每个分量形状都不规则.</li>
</ul></li>
<li>创建纹理后, 怎么修改?
<ul>
<li>2D 的纹理图像缺乏 3D 直观性.</li>
</ul></li>
<li>纹理通常是为某个网格设计的, 换个模型怎么复用?
<ul>
<li>不同的网格有不同的参数化.</li>
</ul></li>
</ul>
<p>一些更 "3D" 的方法可以解决这些问题.</p>
<h3 id="八叉树纹理">11.1  八叉树纹理</h3>
<div class="note note-secondary">
<p>论文: David Benson, Joel Davis, <em>Octree textures</em> (SIGGRAPH
2002).</p>
</div>
<p>用八叉树将空间细分, 在每个叶子结点上存储颜色和材质.</p>
<p>八叉树纹理的一个缺点是获取一个点需要寻址多次——从根节点走到叶子结点.
可以用下面的方法改进:</p>
<ul>
<li><span class="math inline">\(N^3\)</span>-tree, 即每次将空间一分为
<span class="math inline">\(N^3\)</span> (八叉树是一分为 <span class="math inline">\(2^3\)</span>), 这样可以减少树的深度.</li>
<li>将叶子结点存储到 hash 表里, 只需进行常数次次寻址.</li>
</ul>
<h3 id="mesh-colors">11.2  Mesh colors</h3>
<div class="note note-secondary">
<p>原论文: Cem Yuksel, John Keyser, Donald H. House, <em>Mesh
colors</em> (TOG, 2010).</p>
</div>
<p>Mesh colors 直接把颜色存储在三角形网格上. 不光顶点处可以存储颜色,
边上和面内都可以存储颜色. 在确定某点 <span class="math inline">\(p\)</span> 的颜色时, 只需在 <span class="math inline">\(p\)</span> 所在的小三角形内 (虚线组成)
进行线性插值. 下图展示了分辨率 <span class="math inline">\(R=4\)</span>
的一个三角形, 顶点、边和面内一共有 <span class="math inline">\(15\)</span> 个颜色点 (图自论文 PPT, 下同).</p>
<p><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-mesh-colors.png" cloud-img="" style="zoom:35%;" lazyload="true"></p>
<p>Mesh colors 的一大优点是易于编辑. 当改动网格时, 不必重新进行参数化,
只需将涉及到的三角形上的颜色点进行改动即可 (下图左). 此外, mesh colors
还可以实现非均匀分辨率, 即在不同的三角形上可以有不同数量的颜色点
(下图右).</p>
<table>

<thead>
<tr>
<th style="text-align: center;"><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-mesh-colors-editing.png" cloud-img="" style="height:220px;" lazyload="true"></th>
<th style="text-align: center;"><img src="https://raw.githubusercontent.com/Disembo/blog-media/master/cg/proc/4-mesh-colors-non-uniform.png" cloud-img="" style="height:220px;" lazyload="true"></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>Mesh colors 是一个很好的渲染办法, 然而却没有得到广泛的应用,
这大概是因为在论文发表的时候 (2010 年), 基于参数化渲染管线已经发展成熟,
在游戏、电影等各个领域根深蒂固, 难以改变了.</p>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p><span class="math inline">\(|{\cal K}|\)</span> 是 <span class="math inline">\({\cal K}\)</span> 的承载空间 (underlying space).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Bruno Lévy et al, <em>Least Squares Conformal Maps for
Automatic Texture Atlas Generation</em> (TOG, 2002).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>本文中所有牛的 uv map 效果图都是王老师自己实现的.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>© Joseph FS Leng, Art Station.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>From Fatahalian et.al, CS248.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>https://www.hhoppe.com/gim.ppt<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
</body></html>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Note/" class="category-chain-item">Note</a>
  
  
    <span>></span>
    
  <a href="/categories/Note/CG/" class="category-chain-item">CG</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/" class="print-no-link">#计算机图形学</a>
      
        <a href="/tags/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/" class="print-no-link">#计算几何</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>参数化与纹理</div>
      <div>https://disembo.github.io/Note/CG/proc-4-parameterization/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>jin</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年3月21日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="SA - 相同方式共享">
                    <i class="iconfont icon-sa"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/Note/CG/simu-3-fluid/" title="流体模拟">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">流体模拟</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/Note/CG/simu-2-rigid/" title="刚体模拟">
                        <span class="hidden-mobile">刚体模拟</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'Disembo/blog-comments');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        Views: 
        <span id="busuanzi_value_site_pv"></span>
        
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        Visitors: 
        <span id="busuanzi_value_site_uv"></span>
        
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
